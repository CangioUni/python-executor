<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Script Manager</title>
<link rel="stylesheet" href="/static/css/style.css">
<!-- Font Awesome for icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
<header class="header">
  <div class="container">
    <div class="header-content">
      <h1><i class="fas fa-terminal"></i> Script Manager</h1>
      <nav class="nav-links">
        <a href="/add" class="btn btn-outline">
          <i class="fas fa-plus"></i> Add New Script
        </a>
      </nav>
    </div>
  </div>
</header>

<main class="main-content">
  <div class="container">
    <div class="card">
      <div class="card-header">
        <h2 class="card-title">
          <i class="fas fa-list"></i> Scripts Overview
        </h2>
      </div>
      <div class="card-body">
        {% if scripts %}
        <div class="table-container">
          <table>
            <thead>
              <tr>
                <th><i class="fas fa-file-code"></i> Name</th>
                <th><i class="fas fa-cog"></i> Policy</th>
                <th><i class="fas fa-heartbeat"></i> Status</th>
                <th><i class="fas fa-tools"></i> Actions</th>
              </tr>
            </thead>
            <tbody>
              {% for name, script in scripts.items() %}
              <tr data-name="{{ name }}">
                <td>
                  <a href="/script/{{ name }}" class="btn btn-outline btn-sm">
                    <i class="fas fa-eye"></i> {{ name }}
                  </a>
                </td>
                <td>
                  <span class="badge">{{ script.policy }}</span>
                </td>
                <td>
                  <span class="status" id="status-{{ name }}">
                    <i class="fas fa-circle status-icon"></i>
                    <span class="status-text">{{ statuses[name] }}</span>
                  </span>
                </td>
                <td>
                  <div class="action-buttons">
                    <a href="/start/{{ name }}" class="btn btn-success btn-sm">
                      <i class="fas fa-play"></i> Start
                    </a>
                    <a href="/stop/{{ name }}" class="btn btn-danger btn-sm">
                      <i class="fas fa-stop"></i> Stop
                    </a>
                  </div>
                </td>
              </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
        {% else %}
        <div class="text-center">
          <i class="fas fa-folder-open" style="font-size: 3rem; color: var(--text-secondary); margin-bottom: 1rem;"></i>
          <h3>No scripts configured</h3>
          <p style="color: var(--text-secondary); margin-bottom: 2rem;">Get started by adding your first script to monitor and manage.</p>
          <a href="/add" class="btn btn-primary">
            <i class="fas fa-plus"></i> Add Your First Script
          </a>
        </div>
        {% endif %}
      </div>
    </div>
  </div>
</main>

<script>
(function(){
function setStatus(name, status){
  const el = document.getElementById('status-' + name);
  if(!el) return;
  
  const icon = el.querySelector('.status-icon');
  const text = el.querySelector('.status-text');
  
  if (text) text.textContent = status;
  
  // Update status class and icon
  el.className = 'status status-' + status.replace(/\s+/g,'-');
  
  if (icon) {
    icon.className = 'fas fa-circle status-icon';
    if (status === 'running') {
      icon.className = 'fas fa-play-circle status-icon';
    } else if (status === 'stopped') {
      icon.className = 'fas fa-stop-circle status-icon';
    } else if (status.includes('error') || status.includes('failed')) {
      icon.className = 'fas fa-exclamation-circle status-icon';
    }
  }
}

const ws = new WebSocket((location.protocol === 'https:' ? 'wss://' : 'ws://') + location.host + '/ws/status');
ws.onmessage = (ev) => {
  try {
    const data = JSON.parse(ev.data);
    Object.entries(data).forEach(([name, status])=> setStatus(name, status));
  } catch(e) { /* ignore */ }
  // send a ping to keep the loop going server-side
  ws.send('ping');
};

// Add loading states to action buttons
document.addEventListener('click', function(e) {
  if (e.target.matches('.btn[href*="/start/"], .btn[href*="/stop/"]')) {
    e.target.classList.add('loading');
    setTimeout(() => e.target.classList.remove('loading'), 2000);
  }
});
})();
</script>

<style>
.badge {
  display: inline-block;
  padding: 0.25rem 0.5rem;
  font-size: 0.75rem;
  font-weight: 500;
  color: var(--text-secondary);
  background: var(--bg-color);
  border-radius: 4px;
  text-transform: capitalize;
}

.status-icon {
  font-size: 0.75rem;
}

.status-running .status-icon {
  color: var(--success-color);
  animation: pulse 2s infinite;
}

.status-stopped .status-icon {
  color: var(--secondary-color);
}

.status-error .status-icon {
  color: var(--error-color);
  animation: pulse 2s infinite;
}

@keyframes pulse {
  0%, 100% { opacity: 1; }
  50% { opacity: 0.5; }
}
</style>
</body>
</html>